% run_pupil_analysis.m
% 
% Usage: Standard analysis where pupil areas are compared with the variables of the
%        incident trial

clear all;
addpath('./Toolboxes/'); % add path containing ANOVA function
%%

% subjects to be included in analysis
nsubjtot    = 31;
excluded    = [1 23 28];
subjlist    = setdiff(1:nsubjtot, excluded);
nsubj = numel(subjlist);

% Condition to analyze
condtypes = ["rep","alt","rnd"];
nc = numel(condtypes);

epc_struct = {};

% Check pupil_get_epochs.m for optional config.
usecfg = true;
if usecfg
    cfg = struct;
    %cfg.polyorder = 20; % default is nt
    cfg.r_ep_lim = 4; % set the rightward limit of epoch window (in seconds)
    cfg.incl_nan = false;
end

for icond = 1:nc
    if usecfg
        epc_struct{icond} = pupil_get_epochs(subjlist,condtypes{icond},cfg);
    else
        epc_struct{icond} = pupil_get_epochs(subjlist,condtypes{icond});
    end
end

% choose the smallest epoch window for comparison
epc_range    = min([epc_struct{1}.epoch_window; epc_struct{2}.epoch_window; epc_struct{3}.epoch_window],[],1);
epc_fb_onset = [epc_struct{1}.epoch_window(1); epc_struct{2}.epoch_window(1); epc_struct{3}.epoch_window(1)]+1;

ifig = 0;


%% Local functions
function rgb = graded_rgb(ic,iq,nq)
    xc = linspace(.8,.2,nq);

    rgb =  [1,xc(iq),xc(iq); ...
               xc(iq),1,xc(iq); ...
               xc(iq),xc(iq),1];

    rgb = rgb(ic,:);
end
